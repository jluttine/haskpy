
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>haskpy.types.function &#8212; HaskPy 0.1.dev1+g45ff2db documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for haskpy.types.function</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree:</span>

<span class="sd">   Function</span>
<span class="sd">   FunctionMonoid</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree:</span>

<span class="sd">   function</span>
<span class="sd">   compose</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="kn">from</span> <span class="nn">haskpy.typeclasses._monad</span> <span class="kn">import</span> <span class="n">Monad</span>
<span class="kn">from</span> <span class="nn">haskpy.typeclasses._monoid</span> <span class="kn">import</span> <span class="n">Monoid</span>
<span class="kn">from</span> <span class="nn">haskpy.typeclasses._cartesian</span> <span class="kn">import</span> <span class="n">Cartesian</span>
<span class="kn">from</span> <span class="nn">haskpy.typeclasses._cocartesian</span> <span class="kn">import</span> <span class="n">Cocartesian</span>
<span class="kn">from</span> <span class="nn">haskpy.typeclasses._semigroup</span> <span class="kn">import</span> <span class="n">Semigroup</span>

<span class="kn">from</span> <span class="nn">haskpy.internal</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">immutable</span><span class="p">,</span>
    <span class="n">class_property</span><span class="p">,</span>
    <span class="n">class_function</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">haskpy.testing</span> <span class="kn">import</span> <span class="n">eq_test</span>
<span class="kn">from</span> <span class="nn">haskpy</span> <span class="kn">import</span> <span class="n">testing</span>


<span class="nd">@immutable</span>
<span class="k">class</span> <span class="nc">_Code</span><span class="p">():</span>

    <span class="n">co_argcount</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span>
    <span class="n">co_flags</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span>


<div class="viewcode-block" id="FunctionMonoid"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.FunctionMonoid.html#haskpy.types.function.FunctionMonoid">[docs]</a><span class="k">def</span> <span class="nf">FunctionMonoid</span><span class="p">(</span><span class="n">monoid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function type that has a Monoid instance&quot;&quot;&quot;</span>

    <span class="nd">@immutable</span>
    <span class="k">class</span> <span class="nc">_FunctionMonoid</span><span class="p">(</span><span class="n">Monoid</span><span class="p">,</span> <span class="n">Function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function type with Monoid instance added&quot;&quot;&quot;</span>

        <span class="nd">@class_property</span>
        <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_FunctionMonoid</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">monoid</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>

        <span class="nd">@class_function</span>
        <span class="k">def</span> <span class="nf">sample_monoid_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">monoid</span><span class="o">.</span><span class="n">sample_monoid_type</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sample_value</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_FunctionMonoid</span></div>


<div class="viewcode-block" id="Function"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function">[docs]</a><span class="nd">@immutable</span>
<span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Monad</span><span class="p">,</span> <span class="n">Cartesian</span><span class="p">,</span> <span class="n">Cocartesian</span><span class="p">,</span> <span class="n">Semigroup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Monad instance for curried functions</span>

<span class="sd">    Note the resulting ``Function`` object accepts only positional arguments.</span>
<span class="sd">    The number of those positional arguments is exactly the same as the number</span>
<span class="sd">    of required positional arguments in the underlying function. Any optional</span>
<span class="sd">    positional or keyword arguments become unusable. The reason for this is</span>
<span class="sd">    that it must be unambiguous at which point, for instance, ``map`` is</span>
<span class="sd">    applied. Also, ``f(a)(b)`` should always be equal to ``f(a, b)`` with</span>
<span class="sd">    curried functions. This might not be the case if there are optional</span>
<span class="sd">    arguments.</span>

<span class="sd">    Use similar wrapping as functools.wraps does for some attributes. See</span>
<span class="sd">    CPython: https://github.com/python/cpython/blob/master/Lib/functools.py#L30</span>

<span class="sd">    .. note::</span>

<span class="sd">        Monoid instance of Function requires the knowledge of the contained</span>
<span class="sd">        monoid type in order to be able to create ``empty``. The contained type</span>
<span class="sd">        is not known because Function class can be used to create functions of</span>
<span class="sd">        any type. This is just convenience and simpler user interface. If you</span>
<span class="sd">        need Monoid instance of Function, use FunctionMonoid function to create</span>
<span class="sd">        such a class. Note though that the Semigroup instance is available in</span>
<span class="sd">        this Function without needing to use FunctionMonoid.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: Currying functions is a bit slow (mainly because of</span>
    <span class="c1"># functools.wraps). So don&#39;t use converter=curry here. Instead provide a</span>
    <span class="c1"># decorator ``function`` which combines Function and curry.</span>
    <span class="n">__f</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span>

    <span class="n">__args</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">converter</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>

<div class="viewcode-block" id="Function.__attrs_post_init__"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.__attrs_post_init__">[docs]</a>    <span class="k">def</span> <span class="nf">__attrs_post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__qualname__&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__module__&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__doc__&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__annotations__&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__defaults__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;__kwdefaults__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__code__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># We use __code__.co_argcount attribute in this Function class, so</span>
        <span class="c1"># let&#39;s add this attribute to Function objects too so that we can wrap</span>
        <span class="c1"># Function objects with Function class.</span>
        <span class="k">return</span> <span class="n">_Code</span><span class="p">(</span>
            <span class="n">co_argcount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__args</span><span class="p">),</span>
            <span class="c1"># co_flags is needed by Sphinx for some reason..</span>
            <span class="n">co_flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_flags</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__signature__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="p">)</span>

<div class="viewcode-block" id="Function.check_f"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.check_f">[docs]</a>    <span class="nd">@__f</span><span class="o">.</span><span class="n">validator</span>
    <span class="k">def</span> <span class="nf">check_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The function must a callable&quot;</span><span class="p">)</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The function must have at least one required positional &quot;</span>
                <span class="s2">&quot;argument&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Function.check_args"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.check_args">[docs]</a>    <span class="nd">@__args</span><span class="o">.</span><span class="n">validator</span>
    <span class="k">def</span> <span class="nf">check_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="k">return</span></div>

    <span class="c1"># TODO: Add __annotations__</span>

<div class="viewcode-block" id="Function.pure"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.pure">[docs]</a>    <span class="nd">@class_function</span>
    <span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.dimap"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.dimap">[docs]</a>    <span class="k">def</span> <span class="nf">dimap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(b -&gt; c) -&gt; (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a -&gt; d)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">h</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span></div>

<div class="viewcode-block" id="Function.map"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.map">[docs]</a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; (b -&gt; c) -&gt; (a -&gt; c)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Function.contramap"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.contramap">[docs]</a>    <span class="k">def</span> <span class="nf">contramap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Function.apply"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; c&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Function.bind"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; (b -&gt; a -&gt; c) -&gt; a -&gt; c&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))(</span><span class="n">x</span><span class="p">))</span></div>

<div class="viewcode-block" id="Function.first"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.first">[docs]</a>    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; (a, c) -&gt; (b, c)&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">haskpy.utils</span> <span class="kn">import</span> <span class="n">identity</span>
        <span class="k">return</span> <span class="n">_cross</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.second"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.second">[docs]</a>    <span class="k">def</span> <span class="nf">second</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; (c, a) -&gt; (c, b)&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">haskpy.utils</span> <span class="kn">import</span> <span class="n">identity</span>
        <span class="k">return</span> <span class="n">_cross</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.left"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.left">[docs]</a>    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; Either a c -&gt; Either b c&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">haskpy.utils</span> <span class="kn">import</span> <span class="n">identity</span>
        <span class="k">return</span> <span class="n">_plus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.right"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.right">[docs]</a>    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; Either c a -&gt; Either c b&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">haskpy.utils</span> <span class="kn">import</span> <span class="n">identity</span>
        <span class="k">return</span> <span class="n">_plus</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.append"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(a -&gt; b) -&gt; (a -&gt; b) -&gt; (a -&gt; b)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.__call__"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># Don&#39;t add docstring here because it shows up a bit stupidly in help</span>
        <span class="c1"># texts.</span>

        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__args</span> <span class="o">+</span> <span class="n">args</span>

        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="c1"># Function partially applied.</span>
            <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Function__args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
            <span class="c1"># Function fully applied</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Function fully applied and some arguments left over</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="n">n</span><span class="p">])(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">n</span><span class="p">:])</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__f</span><span class="p">)</span>

<div class="viewcode-block" id="Function.__pow__"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.__pow__">[docs]</a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># We need to implement __pow__ for Function objects because otherwise</span>
        <span class="c1"># composing Function objects wouldn&#39;t be possible: If f and g are</span>
        <span class="c1"># Function objects in f ** g, Python will try f.__pow__(g) and if it</span>
        <span class="c1"># fails, it won&#39;t try g.__rpow__(f) because it already concluded that</span>
        <span class="c1"># Function object doesn&#39;t support pow operation with a Function object.</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.__get__"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.__get__">[docs]</a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Support instance methods.</span>

<span class="sd">        See: https://stackoverflow.com/a/3296318</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Instance method, bind the first argument</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="c1"># Keep the docstring untouched</span>
            <span class="n">fp</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="k">return</span> <span class="n">Function</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Class method</span>
            <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Function.__eq_test__"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.Function.html#haskpy.types.function.Function.__eq_test__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq_test__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">input_strategy</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">()):</span>
        <span class="c1"># NOTE: This is used only in tests when the function input doesn&#39;t</span>
        <span class="c1"># really matter so any hashable type here is ok. The type doesn&#39;t</span>
        <span class="c1"># matter because the functions are either _TestFunction or created with</span>
        <span class="c1"># pure.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">input_strategy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eq_test</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@class_function</span>
    <span class="k">def</span> <span class="nf">sample_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_function</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="n">sample_type</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_type_from_value</span><span class="p">(</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_hashable_type</span><span class="p">(),</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_type</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="n">sample_semigroup_type</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_type_from_value</span><span class="p">(</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_hashable_type</span><span class="p">(),</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_semigroup_type</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="n">sample_monoid_type</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_type_from_value</span><span class="p">(</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_hashable_type</span><span class="p">(),</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_monoid_type</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="n">sample_functor_type</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_type_from_value</span><span class="p">(</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">sample_hashable_type</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">sample_applicative_type</span> <span class="o">=</span> <span class="n">sample_functor_type</span>
    <span class="n">sample_monad_type</span> <span class="o">=</span> <span class="n">sample_functor_type</span>

    <span class="nd">@class_function</span>
    <span class="k">def</span> <span class="nf">sample_contravariant_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">tuples</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_type</span><span class="p">())</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">args</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sample_value</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">sample_profunctor_type</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">sample_type_from_value</span><span class="p">()</span></div>


<div class="viewcode-block" id="function"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.function.html#haskpy.types.function.function">[docs]</a><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator for currying and transforming functions into monads&quot;&quot;&quot;</span>
    <span class="c1"># Don&#39;t wrap twice</span>
    <span class="k">return</span> <span class="n">f</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Function</span><span class="p">)</span> <span class="k">else</span> <span class="n">Function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="compose"><a class="viewcode-back" href="../../../_autosummary/haskpy.types.function.compose.html#haskpy.types.function.compose">[docs]</a><span class="nd">@function</span>
<span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>


<span class="nd">@function</span>
<span class="k">def</span> <span class="nf">_cross</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">ab</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;(a -&gt; c) -&gt; (b -&gt; d) -&gt; (a, b) -&gt; (c, d)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">g</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


<span class="nd">@function</span>
<span class="k">def</span> <span class="nf">_plus</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">eab</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;(a -&gt; c) -&gt; (b -&gt; d) -&gt; Either a b -&gt; Either c d&quot;&quot;&quot;</span>
    <span class="c1"># FIXME: Once Bifunctor has been implemented, just use:</span>
    <span class="c1"># eab.bimap(f, g)</span>
    <span class="kn">from</span> <span class="nn">haskpy.types.either</span> <span class="kn">import</span> <span class="n">Left</span><span class="p">,</span> <span class="n">Right</span>
    <span class="k">return</span> <span class="n">eab</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">Left</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">Left</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="n">Right</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">Right</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">HaskPy</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../motivation.html">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../property-based-testing.html">Property-based testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2020, Jaakko Luttinen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>